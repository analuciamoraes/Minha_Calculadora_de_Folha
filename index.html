<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calculadora de Folha Mensal</title>
<style>
  :root {
    --roxo-principal: #b497ff;
    --roxo-claro: #ede7ff;
    --roxo-escuro: #6b42c1;
    --roxo-pastel: #d7caff;
    --texto-escuro: #2c2047;
    --fundo-claro: #ffffff;
    --fundo-escuro: #1c1b29;
  }
  body { font-family: "Poppins", sans-serif; background-color: var(--fundo-claro); color: var(--texto-escuro); margin: 0; padding: 0; transition: background 0.3s, color 0.3s; }
  body.dark-mode { background-color: var(--fundo-escuro); color: var(--roxo-principal); }
  h1 { text-align: center; color: var(--roxo-escuro); margin-top: 20px; }
  body.dark-mode h1 { color: var(--roxo-principal); }
  .tema-toggle { position: fixed; top: 10px; right: 10px; background: var(--roxo-pastel, #d8c7f7); color: #4b3b73; border: none; border-radius: 50%; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.1); transition: all 0.3s ease; }
  .tema-toggle:hover { transform: scale(1.08); background: var(--lilas-pastel, #e6dcfa); }
  .container { max-width: 800px; margin: 20px auto; background-color: var(--fundo-claro); padding: 20px; border-radius: 16px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); transition: background 0.3s; }
  body.dark-mode .container { background-color: #2a2640; }
  .linha { display: flex; justify-content: space-between; gap: 20px; margin-top: 20px; }
  .coluna { flex: 1; background-color: var(--roxo-claro); border-radius: 12px; padding: 15px; }
  body.dark-mode .coluna { background-color: #3a3360; }
  h2 { text-align: center; color: var(--roxo-escuro); }
  body.dark-mode h2 { color: var(--roxo-principal); }
  label { display: block; margin: 8px 0 4px; font-size: 0.9em; }
  input[type="number"], input[type="text"] { width: 100%; padding: 6px; border-radius: 6px; border: 1px solid var(--roxo-pastel); font-size: 0.9em; }
  .checkbox-group { display: flex; align-items: center; gap: 6px; margin-top: 8px; }
  button { background-color: var(--roxo-escuro); color: white; border: none; border-radius: 8px; padding: 10px 18px; cursor: pointer; margin-top: 20px; width: 100%; }
  button:hover { background-color: var(--roxo-principal); }
  .resultados { text-align: center; margin-top: 25px; display: none; }
  .cards { display: flex; justify-content: center; gap: 12px; flex-wrap: wrap; }
  .card-resultado { background-color: var(--roxo-pastel); color: var(--texto-escuro); padding: 10px; border-radius: 10px; width: 150px; transition: 0.3s; }
  body.dark-mode .card-resultado { background-color: #4c3a82; color: var(--roxo-claro); }
  .liquido { background-color: var(--roxo-escuro); color: white; font-weight: bold; font-size: 1.2em; margin-top: 15px; width: 80%; margin-left: auto; margin-right: auto; }
  .tooltip-info { display: none; margin-top: 15px; background-color: var(--roxo-claro); color: var(--texto-escuro); border-radius: 8px; padding: 10px; font-size: 0.9em; width: 80%; margin-left: auto; margin-right: auto; }
  body.dark-mode .tooltip-info { background-color: #3a3360; color: var(--roxo-principal); }
</style>
</head>
<body>
  <button class="tema-toggle" id="temaBotao" onclick="alternarTema()">🌙</button>
  <h1>Calculadora de Folha Mensal</h1>

  <div class="container">
    <label for="mesAno">Mês/Ano:</label>
    <input type="text" id="mesAno" maxlength="7" placeholder="Ex: 05/2025" oninput="formatarMesAno(this)">

    <label for="salarioBruto">Salário Bruto:</label>
    <input type="number" id="salarioBruto" oninput="copiarSalario()" step="0.01">

    <div class="linha">
      <div class="coluna">
        <h2>Proventos</h2>
        <label for="salario">Salário:</label>
        <input type="number" id="salario" step="0.01" readonly>

        <label for="proventoAdicional">Provento Adicional:</label>
        <input type="number" id="proventoAdicional" step="0.01" value="0">
      </div>

      <div class="coluna">
        <h2>Descontos</h2>
        <label for="descontoAdicional">Desconto Adicional:</label>
        <input type="number" id="descontoAdicional" step="0.01" value="0">

        <div class="checkbox-group">
          <input type="checkbox" id="possuiDependente" onchange="toggleCampoDependente()">
          <label for="possuiDependente">Possui Dependente?</label>
        </div>
        <input type="number" id="qtdDependente" step="1" min="0" placeholder="Qtd dependentes" style="display:none;">

        <div class="checkbox-group">
          <input type="checkbox" id="possuiPensao" onchange="toggleCampoPensao()">
          <label for="possuiPensao">Possui Pensão?</label>
        </div>
        <input type="number" id="valorPensao" step="0.01" placeholder="Valor pensão" style="display:none;">
      </div>
    </div>

    <button onclick="calcular()">Calcular</button>

    <div class="resultados" id="resultados">
      <div class="cards">
        <div id="inss" class="card-resultado"></div>
        <div id="irrf" class="card-resultado"></div>
        <div id="fgts" class="card-resultado"></div>
      </div>
      <div id="liquido" class="card-resultado liquido"></div>
      <div class="tooltip-info" id="tooltipInfo">
        💡 Informação sobre o desconto aplicado aparecerá aqui após calcular.
      </div>
    </div>
  </div>

<script>
function alternarTema() {
  const body = document.body;
  const botao = document.getElementById("temaBotao");
  body.classList.toggle("dark-mode");
  botao.textContent = body.classList.contains("dark-mode") ? "☀️" : "🌙";
}

function formatarMesAno(input) {
  let valor = input.value.replace(/\D/g, '');
  if (valor.length > 2) {
    valor = valor.substring(0, 2) + '/' + valor.substring(2, 6);
  }
  input.value = valor;
}

function copiarSalario() {
  const val = document.getElementById('salarioBruto').value;
  document.getElementById('salario').value = val;
}

function toggleCampoDependente() {
  const campo = document.getElementById('qtdDependente');
  campo.style.display = document.getElementById('possuiDependente').checked ? 'block' : 'none';
}

function toggleCampoPensao() {
  const campo = document.getElementById('valorPensao');
  campo.style.display = document.getElementById('possuiPensao').checked ? 'block' : 'none';
}

function calcular() {
  // leitura dos inputs com fallback para 0
  const salario = parseFloat(document.getElementById('salario').value) || 0;
  const adicional = parseFloat(document.getElementById('proventoAdicional').value) || 0;
  const descontoAdicional = parseFloat(document.getElementById('descontoAdicional').value) || 0;
  const dependentes = document.getElementById('possuiDependente').checked ? parseInt(document.getElementById('qtdDependente').value) || 0 : 0;
  const pensao = document.getElementById('possuiPensao').checked ? parseFloat(document.getElementById('valorPensao').value) || 0 : 0;

  // total de proventos (base comum)
  const totalProventos = salario + adicional;
  const fgts = totalProventos * 0.08;

  // -------------------------
  // 1) INSS progressivo (corrigido por largura de faixa)
  // -------------------------
  const teto = 8157.41;
  // faixas: limite superior da faixa e aliquota aplicável naquela faixa
  const faixas = [
    { limite: 1518.00, aliquota: 0.075 },
    { limite: 2793.88, aliquota: 0.09 },
    { limite: 4190.83, aliquota: 0.12 },
    { limite: teto, aliquota: 0.14 }
  ];
  let inss = 0;
  let baseRestante = Math.min(totalProventos, teto);
  let inicioFaixa = 0;
  for (const f of faixas) {
    const largura = f.limite - inicioFaixa; // largura da faixa
    const parteTributavel = Math.min(baseRestante, largura);
    if (parteTributavel > 0) {
      inss += parteTributavel * f.aliquota;
      baseRestante -= parteTributavel;
    }
    inicioFaixa = f.limite;
    if (baseRestante <= 0) break;
  }
  // arredondar para 2 casas
  inss = Math.round(inss * 100) / 100;

  // -------------------------
  // 2) Deduções legais para IR (dependentes + pensão + INSS)
  // -------------------------
  const deducaoDependente = dependentes * 189.59;
  const descontosLegais = inss + pensao + deducaoDependente;

  // -------------------------
  // 3) Desconto simplificado (interpretei como 25% da primeira faixa do IRRF)
  //    (primeira faixa usada: 2428.80 conforme lógica de cálculo abaixo)
  // -------------------------
  const primeiraFaixaIRRF = 2428.80; // conforme o código original
  const descontoSimplificado = primeiraFaixaIRRF * 0.25; // 25% da primeira faixa

  // -------------------------
  // 4) Escolher dedução (maior entre legal e simplificado) e montar base do IRRF
  // -------------------------
  const deducaoAplicada = Math.max(descontosLegais, descontoSimplificado);
  let baseFinal = totalProventos - deducaoAplicada;
  if (baseFinal < 0) baseFinal = 0;
  // arredondar baseFinal
  baseFinal = Math.round(baseFinal * 100) / 100;

  // determinar qual dedução foi usada (mensagem)
  let mensagemDeducao = '';
  if (descontosLegais > descontoSimplificado) {
    mensagemDeducao = `💡 Desconto aplicado: Desconto legal (INSS + pensão + dependentes) — R$ ${descontosLegais.toFixed(2)}`;
  } else if (descontosLegais < descontoSimplificado) {
    mensagemDeducao = `💡 Desconto aplicado: Desconto simplificado — R$ ${descontoSimplificado.toFixed(2)}`;
  } else {
    // iguais
    mensagemDeducao = `💡 Desconto aplicado: Desconto legal e simplificado (valores iguais) — R$ ${descontosLegais.toFixed(2)}`;
  }

  // -------------------------
  // 5) Cálculo IRRF (tabela utilizada no seu código, aplicada como imposto = base * aliquota - parcela)
  // -------------------------
  // tabela: limite superior, aliquota, parcela a deduzir
  const tabelaIRRF = [
    { limite: 2428.80, aliquota: 0.0, parcela: 0.00 },
    { limite: 2826.65, aliquota: 0.075, parcela: 182.16 },
    { limite: 3751.05, aliquota: 0.15, parcela: 394.16 },
    { limite: 4664.68, aliquota: 0.225, parcela: 675.49 },
    { limite: Infinity, aliquota: 0.275, parcela: 908.73 }
  ];

  let ir = 0;
  for (const t of tabelaIRRF) {
    if (baseFinal <= t.limite) {
      ir = baseFinal * t.aliquota - t.parcela;
      break;
    }
  }
  if (ir < 0) ir = 0;
  ir = Math.round(ir * 100) / 100;

  // -------------------------
  // 6) Líquido e exibição
  // -------------------------
  const totalDescontos = inss + ir + descontoAdicional + pensao; // pensão deve diminuir o líquido
  const liquido = Math.round((totalProventos - totalDescontos) * 100) / 100;

  document.getElementById('resultados').style.display = 'block';
  const tooltipEl = document.getElementById('tooltipInfo');
  tooltipEl.style.display = 'block';
  tooltipEl.innerHTML = mensagemDeducao;

  document.getElementById('inss').innerHTML = `INSS<br>R$ ${inss.toFixed(2)}`;
  document.getElementById('irrf').innerHTML = `IRRF<br>R$ ${ir.toFixed(2)}<br><small>Base IR: R$ ${baseFinal.toFixed(2)}</small>`;
  document.getElementById('fgts').innerHTML = `FGTS<br>R$ ${fgts.toFixed(2)}`;
  document.getElementById('liquido').innerHTML = `💰 Líquido a receber: R$ ${liquido.toFixed(2)}`;
}
</script>
</body>
</html>

